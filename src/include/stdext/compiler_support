// Copyright (c) 2019 - Gabriel Cuvillier, Continuation Labs (www.continuation-labs.com)
// Licensed under the MIT License.

#ifndef STDEXT_COMPILER_SUPPORT
#define STDEXT_COMPILER_SUPPORT

// [[nodiscard]] attribute activation depending on compiler features
#if defined( __has_cpp_attribute )
#if __has_cpp_attribute( nodiscard )
#define stdext_NODISCARD [[nodiscard]]
#else
#define stdext_NODISCARD
#endif
#elif defined( __GNUC__ )
#define stdext_NODISCARD __attribute__( ( warn_unused_result ) )
#else
#define stdext_NODISCARD
#endif

// 'if constexpr'
#if defined( __cplusplus ) && ( __cplusplus >= 201703L )
#define stdext_IF_CONSTEXPR constexpr
#else
#define stdext_IF_CONSTEXPR
#endif

#if defined(__cplusplus) && (__cplusplus >= 201703L)
#define stdext_FALLTHROUGH [[fallthrough]];
#elif defined(__GNUC__) && (__GNUC__ >= 7)
#define stdext_FALLTHROUGH __attribute__((fallthrough));
#else
#define stdext_FALLTHROUGH
#endif

// code location handling depending on compiler features (WIP)
#if defined( __clang__ )
#define stdext_FILE __builtin_FILE()
#define stdext_LINE __builtin_LINE()
#define stdext_FUNCTION __builtin_FUNCTION()
#else
#define stdext_FILE "<unknown_file>"
#define stdext_LINE -1
#define stdext_FUNCTION "<unknown_function>"
#endif

#if defined(__cplusplus) && (__cplusplus >= 201100L)
#define stdext_OVERRIDE override
#elif defined(_MSC_VER) && (_MSC_VER >= 1700)
#define stdext_OVERRIDE override
#else
#define stdext_OVERRIDE
#endif

#if defined(__cplusplus) && (__cplusplus >= 201703L)
#if defined(_MSC_VER)
#define _SILENCE_CXX17_ITERATOR_BASE_CLASS_DEPRECATION_WARNING
#define _SILENCE_ALL_CXX17_DEPRECATION_WARNINGS
#endif
#endif

// unused
#if defined( __GNUC__ ) || defined( __clang__ )
#define stdext_UNUSED __attribute__( ( unused ) )
#else
#define stdext_UNUSED
#endif

#endif
